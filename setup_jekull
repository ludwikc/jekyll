# Define the paths
JEKYLL_PROJECT_PATH="/Users/ludwikc/git/ludwikc.net"
MINIMA_GEM_PATH="/opt/homebrew/lib/ruby/gems/3.3.0/gems/minima-2.5.1"

# Step 1: Create the necessary directories in your Jekyll project if they don't already exist
mkdir -p $JEKYLL_PROJECT_PATH/_sass
mkdir -p $JEKYLL_PROJECT_PATH/assets/css

# Step 2: Copy _sass/minima.scss from Minima gem to your Jekyll project's _sass directory
cp $MINIMA_GEM_PATH/_sass/minima.scss $JEKYLL_PROJECT_PATH/_sass/

# Step 3: Copy _sass/minima/_layout.scss from Minima gem to your Jekyll project's _sass/minima directory
mkdir -p $JEKYLL_PROJECT_PATH/_sass/minima
cp $MINIMA_GEM_PATH/_sass/minima/_layout.scss $JEKYLL_PROJECT_PATH/_sass/minima/

# Step 4: Create a new ludwikc-jekyll-minima.scss file in your Jekyll project's _sass directory
cat <<EOT > $JEKYLL_PROJECT_PATH/_sass/ludwikc-jekyll-minima.scss
/* Add your custom styles here */

EOT

# Step 5: Copy the main.scss from Minima gem to your Jekyll project's assets/css directory
cp $MINIMA_GEM_PATH/assets/main.scss $JEKYLL_PROJECT_PATH/assets/css/

# Step 6: Modify the copied main.scss to include ludwikc-jekyll-minima.scss
sed -i '' '1s/^/@import "minima";\n@import "ludwikc-jekyll-minima";\n/' $JEKYLL_PROJECT_PATH/assets/css/main.scss

# Step 7: Ensure that the main.scss file is included in the _includes/head.html
mkdir -p $JEKYLL_PROJECT_PATH/_includes
cat <<EOT > $JEKYLL_PROJECT_PATH/_includes/head.html
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
EOT

# Step 8: Ensure _layouts/default.html includes the head.html file
mkdir -p $JEKYLL_PROJECT_PATH/_layouts
if ! grep -q '{% include head.html %}' $JEKYLL_PROJECT_PATH/_layouts/default.html; then
  sed -i '' 's|</head>|  {% include head.html %}\n</head>|' $JEKYLL_PROJECT_PATH/_layouts/default.html
fi

# Step 9: Modify the _config.yml file to ensure includes are set correctly
cat <<EOT >> $JEKYLL_PROJECT_PATH/_config.yml

include:
  - _includes
  - _layouts
  - assets
  - _sass

sass:
  sass_dir: _sass
  style: compressed
EOT

# Step 10: Install the bundle and build the site
cd $JEKYLL_PROJECT_PATH
bundle install
bundle exec jekyll build
bundle exec jekyll serve

